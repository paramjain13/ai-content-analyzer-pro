<!DOCTYPE html>
<html>
<head>
<title>AI Content Analyzer</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/dark-mode.css') }}">
<style>
body{
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 40px;
    margin: 0;
    transition: background 0.3s;
}
.container{
    max-width: 1200px;
    margin: auto;
    background: #fff;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    transition: background 0.3s, color 0.3s;
}
.top-nav{
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: #f0f4ff;
    border-radius: 8px;
    transition: background 0.3s;
}
.user-section{
    display: flex;
    align-items: center;
    gap: 12px;
}
.user-avatar{
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}
.user-info-text{
    display: flex;
    flex-direction: column;
}
.username{
    font-weight: 600;
    color: #333;
}
.user-status{
    font-size: 12px;
    color: #666;
}
.nav-buttons{
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
.nav-btn{
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 6px;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s;
}
.nav-btn-primary{
    background: #667eea;
    color: white;
}
.nav-btn-primary:hover{
    opacity: 0.9;
}
.nav-btn-secondary{
    background: #f0f0f0;
    color: #333;
}
.nav-btn-secondary:hover{
    background: #e0e0e0;
}
h1{
    color: #333;
    text-align: center;
    margin-bottom: 10px;
}
.subtitle{
    text-align: center;
    color: #666;
    margin-bottom: 30px;
    font-size: 14px;
}
.form-group{
    margin-bottom: 20px;
}
.form-group label{
    display: block;
    font-weight: bold;
    margin-bottom: 8px;
    color: #555;
}
.form-group select, .form-group input[type="text"]{
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    box-sizing: border-box;
    transition: all 0.3s;
}
.form-group select:focus, .form-group input:focus{
    border-color: #667eea;
    outline: none;
}
.file-upload-section{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    margin-top: 15px;
}
.file-upload-box{
    border: 2px dashed #ddd;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}
.file-upload-box:hover{
    border-color: #667eea;
    background: #f9f9fb;
    transform: translateY(-2px);
}
.file-upload-box input[type="file"]{
    display: none;
}
.file-upload-icon{
    font-size: 32px;
    margin-bottom: 10px;
}
.file-upload-label{
    font-weight: bold;
    color: #555;
    font-size: 14px;
    display: block;
    margin-bottom: 5px;
}
.file-upload-hint{
    font-size: 11px;
    color: #999;
}
.btn-submit{
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 40px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    width: 100%;
    margin-top: 10px;
    transition: all 0.3s;
}
.btn-submit:hover{
    opacity: 0.9;
    transform: translateY(-2px);
}
.card{
    background: #f9f9fb;
    padding: 25px;
    margin-top: 25px;
    border-radius: 10px;
    border-left: 4px solid #667eea;
    animation: fadeIn 0.5s ease-in;
}
.card h2{
    margin-top: 0;
    color: #333;
}
.card h3{
    color: #667eea;
    margin-top: 20px;
    margin-bottom: 10px;
}
.confidence{
    font-weight: bold;
    color: #1f7a1f;
    font-size: 18px;
}
.analysis-grid{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 25px;
}
.analysis-card{
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s;
}
.analysis-card:hover{
    transform: translateY(-4px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
}
.analysis-card h4{
    margin-top: 0;
    color: #667eea;
    font-size: 16px;
}
.sentiment-box{
    text-align: center;
    padding: 15px;
    background: #f0f4ff;
    border-radius: 8px;
    margin-top: 10px;
}
.sentiment-emoji{
    font-size: 48px;
    margin-bottom: 10px;
}
.sentiment-label{
    font-size: 20px;
    font-weight: bold;
    color: #333;
}
.stat-item{
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}
.stat-label{
    color: #666;
}
.stat-value{
    font-weight: bold;
    color: #333;
}
.keywords{
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}
.keyword-tag{
    background: #667eea;
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.3s;
}
.keyword-tag:hover{
    transform: scale(1.05);
}
.reading-time{
    font-size: 24px;
    font-weight: bold;
    color: #667eea;
    text-align: center;
    margin: 10px 0;
}
ul{
    line-height: 1.8;
}
.entity-section{
    margin-top: 15px;
}
.entity-category{
    margin-bottom: 15px;
}
.entity-category-title{
    font-weight: bold;
    color: #555;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}
.entity-icon{
    font-size: 18px;
}
.entity-list{
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.entity-badge{
    background: #e8f0ff;
    color: #667eea;
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 13px;
    border: 1px solid #667eea;
    transition: all 0.3s;
}
.entity-badge:hover{
    transform: scale(1.05);
}
.entity-badge.person{
    background: #fff3e0;
    color: #f57c00;
    border-color: #f57c00;
}
.entity-badge.org{
    background: #e8f5e9;
    color: #2e7d32;
    border-color: #2e7d32;
}
.entity-badge.location{
    background: #e3f2fd;
    color: #1565c0;
    border-color: #1565c0;
}
.entity-badge.date{
    background: #f3e5f5;
    color: #7b1fa2;
    border-color: #7b1fa2;
}
.entity-badge.money{
    background: #fff9c4;
    color: #f57f17;
    border-color: #f57f17;
}
.topic-list{
    margin-top: 10px;
}
.topic-item{
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: #f0f4ff;
    margin-bottom: 8px;
    border-radius: 8px;
    border-left: 4px solid #667eea;
    transition: all 0.3s;
}
.topic-item:hover{
    transform: translateX(5px);
}
.topic-name{
    font-weight: bold;
    color: #333;
}
.topic-confidence{
    background: #667eea;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}
.language-info{
    text-align: center;
    padding: 15px;
    background: #f0f4ff;
    border-radius: 8px;
    margin-top: 10px;
}
.language-flag{
    font-size: 48px;
    margin-bottom: 10px;
}
.language-name{
    font-size: 20px;
    font-weight: bold;
    color: #333;
}
.readability-score{
    text-align: center;
    padding: 15px;
    background: #f0f4ff;
    border-radius: 8px;
    margin-top: 10px;
}
.readability-number{
    font-size: 48px;
    font-weight: bold;
    color: #667eea;
    margin: 10px 0;
}
.readability-level{
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 5px;
}
.readability-desc{
    font-size: 13px;
    color: #666;
}
.metadata-section{
    background: #f0f4ff;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
}
.metadata-item{
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
    font-size: 13px;
}
.metadata-label{
    color: #666;
    font-weight: 600;
}
.metadata-value{
    color: #333;
}
.divider{
    text-align: center;
    margin: 20px 0;
    color: #999;
    font-weight: bold;
}
.qa-container{
    margin-top: 15px;
}
.qa-item{
    background: white;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 8px;
    border-left: 4px solid #667eea;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    transition: all 0.3s;
}
.qa-item:hover{
    transform: translateX(5px);
}
.qa-question{
    font-weight: bold;
    color: #667eea;
    font-size: 16px;
    margin-bottom: 10px;
}
.qa-question:before{
    content: "‚ùì ";
}
.qa-answer{
    color: #333;
    line-height: 1.6;
}
.timeline-container{
    margin-top: 15px;
    position: relative;
    padding-left: 30px;
}
.timeline-item{
    position: relative;
    padding-bottom: 20px;
    border-left: 2px solid #667eea;
    padding-left: 25px;
}
.timeline-item:last-child{
    border-left: 2px solid transparent;
}
.timeline-dot{
    position: absolute;
    left: -6px;
    top: 0;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #667eea;
}
.timeline-timestamp{
    font-weight: bold;
    color: #667eea;
    font-size: 14px;
    margin-bottom: 5px;
}
.timeline-description{
    color: #333;
    line-height: 1.6;
}
.insights-container{
    margin-top: 15px;
}
.insight-item{
    background: #f0f4ff;
    padding: 15px 20px;
    margin-bottom: 12px;
    border-radius: 8px;
    border-left: 4px solid #667eea;
    display: flex;
    gap: 12px;
    transition: all 0.3s;
}
.insight-item:hover{
    transform: translateX(5px);
}
.insight-icon{
    font-size: 24px;
    flex-shrink: 0;
}
.insight-text{
    color: #333;
    line-height: 1.6;
    flex: 1;
}
.chat-section{
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-top: 30px;
    overflow: hidden;
}
.chat-header{
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
}
.chat-header-icon{
    font-size: 32px;
}
.chat-header-text h3{
    margin: 0;
    font-size: 20px;
}
.chat-header-text p{
    margin: 5px 0 0 0;
    font-size: 13px;
    opacity: 0.9;
}
.suggested-questions{
    padding: 20px;
    background: #f9f9fb;
    border-bottom: 1px solid #e0e0e0;
}
.suggested-questions h4{
    margin: 0 0 12px 0;
    color: #667eea;
    font-size: 14px;
    font-weight: 600;
}
.question-chips{
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
.question-chip{
    background: white;
    border: 2px solid #667eea;
    color: #667eea;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.3s;
}
.question-chip:hover{
    background: #667eea;
    color: white;
    transform: translateY(-2px);
}
.chat-messages{
    height: 400px;
    overflow-y: auto;
    padding: 20px;
    background: white;
}
.chat-message{
    margin-bottom: 20px;
    display: flex;
    gap: 12px;
    animation: slideIn 0.3s ease-out;
}
.chat-message.user{
    flex-direction: row-reverse;
}
.message-avatar{
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
}
.message-avatar.user-avatar{
    background: #667eea;
    color: white;
}
.message-avatar.bot-avatar{
    background: #e8f0ff;
}
.message-content{
    max-width: 70%;
    padding: 12px 16px;
    border-radius: 12px;
    line-height: 1.5;
    font-size: 14px;
}
.chat-message.user .message-content{
    background: #667eea;
    color: white;
    border-bottom-right-radius: 4px;
}
.chat-message.assistant .message-content{
    background: #f0f4ff;
    color: #333;
    border-bottom-left-radius: 4px;
}
.message-sources{
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid rgba(0,0,0,0.1);
}
.message-sources-title{
    font-size: 11px;
    font-weight: 600;
    color: #667eea;
    margin-bottom: 5px;
}
.source-item{
    font-size: 11px;
    color: #666;
    margin: 3px 0;
    padding-left: 10px;
    border-left: 2px solid #667eea;
}
.typing-indicator{
    display: flex;
    gap: 4px;
    padding: 12px 16px;
    background: #f0f4ff;
    border-radius: 12px;
    width: fit-content;
}
.typing-dot{
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #667eea;
    animation: typing 1.4s infinite;
}
.typing-dot:nth-child(2){
    animation-delay: 0.2s;
}
.typing-dot:nth-child(3){
    animation-delay: 0.4s;
}
@keyframes typing {
    0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-10px); opacity: 1; }
}
.chat-input-area{
    padding: 20px;
    background: #f9f9fb;
    border-top: 1px solid #e0e0e0;
}
.chat-input-wrapper{
    display: flex;
    gap: 10px;
}
.chat-input{
    flex: 1;
    padding: 12px 16px;
    border: 2px solid #ddd;
    border-radius: 25px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.3s;
}
.chat-input:focus{
    border-color: #667eea;
}
.chat-send-btn{
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
}
.chat-send-btn:hover{
    transform: scale(1.1);
}
.chat-send-btn:disabled{
    opacity: 0.5;
    cursor: not-allowed;
}
.empty-chat{
    text-align: center;
    padding: 60px 20px;
    color: #999;
}
.empty-chat-icon{
    font-size: 64px;
    margin-bottom: 16px;
}
.empty-chat-text{
    font-size: 16px;
    font-weight: 500;
}
.export-grid{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-top: 15px;
}
.export-btn{
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s;
    text-align: center;
    text-decoration: none;
    display: block;
}
.export-btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.export-pdf{
    background: #e74c3c;
    color: white;
}
.export-docx{
    background: #3498db;
    color: white;
}
.export-md{
    background: #95a5a6;
    color: white;
}
.export-json{
    background: #f39c12;
    color: white;
}
.alert{
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-size: 14px;
    animation: slideIn 0.3s ease-out;
}
.alert-success{
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}
.alert-error{
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}
.copy-btn{
    background: #667eea;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.3s;
}
.copy-btn:hover{
    background: #5568d3;
    transform: translateY(-2px);
}
.dark-mode-toggle{
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
    font-size: 28px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: transform 0.3s, box-shadow 0.3s;
    z-index: 1000;
}
.dark-mode-toggle:hover{
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0,0,0,0.4);
}
.keyboard-shortcuts{
    position: fixed;
    bottom: 100px;
    right: 30px;
    background: white;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    font-size: 13px;
    z-index: 999;
    display: none;
}
.shortcut-item{
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin: 5px 0;
}
.shortcut-key{
    background: #667eea;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-family: monospace;
    font-size: 11px;
}
@keyframes fadeIn{
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes slideIn{
    from { transform: translateX(-20px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
@media (max-width: 768px){
    body{
        padding: 20px;
    }
    .container{
        padding: 20px;
    }
    .analysis-grid{
        grid-template-columns: 1fr;
    }
    .file-upload-section{
        grid-template-columns: repeat(2, 1fr);
    }
    .export-grid{
        grid-template-columns: 1fr 1fr;
    }
    .top-nav{
        flex-direction: column;
        gap: 15px;
    }
    .nav-buttons{
        width: 100%;
        justify-content: center;
    }
    .chat-messages{
        height: 300px;
    }
    .message-content{
        max-width: 85%;
    }
    .dark-mode-toggle{
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        font-size: 24px;
    }
    .keyboard-shortcuts{
        display: none !important;
    }
}
</style>
</head>
<body>
<div class="container">

<!-- Navigation -->
{% if current_user.is_authenticated %}
<div class="top-nav">
    <div class="user-section">
        <div class="user-avatar">{{ current_user.username[0].upper() }}</div>
        <div class="user-info-text">
            <div class="username">{{ current_user.username }}</div>
            <div class="user-status">Logged in</div>
        </div>
    </div>
    <div class="nav-buttons">
        <a href="{{ url_for('batch') }}" class="nav-btn nav-btn-secondary">üîÑ Batch</a>
        <a href="{{ url_for('history') }}" class="nav-btn nav-btn-primary">üìö History</a>
        <a href="{{ url_for('collections') }}" class="nav-btn nav-btn-secondary">üìÇ Collections</a>
        <button class="nav-btn nav-btn-secondary" onclick="toggleShortcutsHelp()">‚å®Ô∏è</button>
        <a href="{{ url_for('logout') }}" class="nav-btn nav-btn-secondary">Logout</a>
    </div>
</div>
{% else %}
<div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
    <a href="{{ url_for('batch') }}" class="nav-btn nav-btn-secondary">üîÑ Batch Processing</a>
    <div style="display: flex; gap: 10px;">
        <a href="{{ url_for('login') }}" class="nav-btn nav-btn-primary">Login</a>
        <a href="{{ url_for('register') }}" class="nav-btn nav-btn-secondary">Sign Up</a>
    </div>
</div>
{% endif %}

<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<h1>üöÄ AI Content Analyzer</h1>
<p class="subtitle">Analyze websites, documents, images with advanced AI-powered summaries & chat</p>

<form method="post" enctype="multipart/form-data">
    <div class="form-group">
        <label>Summarization Mode</label>
        <select name="mode">
            <option value="llm">ü§ñ AI Summary (Best Quality)</option>
            <option value="nlp">‚ö° Fast Summary (Quick)</option>
        </select>
    </div>

       <!-- ADD THIS NEW SECTION -->
    <div class="form-group">
        <label>ü§ñ AI Model</label>
        <select name="model_id">
            <option value="gpt-4o-mini">GPT-4o Mini - Fast & Economical (OpenAI)</option>
            <option value="gpt-4o">GPT-4o - Highest Quality (OpenAI)</option>
            <option value="gemini-pro">Gemini 1.5 Pro - Free Tier Available (Google) ‚ú®</option>
        </select>
        <div style="font-size: 12px; color: #666; margin-top: 5px; padding: 8px; background: #f0f4ff; border-radius: 6px;">
            üí° <strong>Tip:</strong> Gemini Pro has a generous free tier - great for testing!<br>
            ‚ö° GPT-4o Mini is fastest and cheapest<br>
            ‚≠ê GPT-4o gives best quality results
        </div>
    </div>

    <div class="form-group">
        <label>Summary Format</label>
        <select name="summary_format">
            <option value="bullets">üìù Bullet Points (Traditional)</option>
            <option value="qa">‚ùì Q&A Format (Questions & Answers)</option>
            <option value="timeline">‚è±Ô∏è Timeline (Chronological)</option>
            <option value="insights">üí° Key Insights (Main Takeaways)</option>
        </select>
    </div>

    <div class="form-group">
        <label>Summary Format</label>
        <select name="summary_format">
            <option value="bullets">üìù Bullet Points (Traditional)</option>
            <option value="qa">‚ùì Q&A Format (Questions & Answers)</option>
            <option value="timeline">‚è±Ô∏è Timeline (Chronological)</option>
            <option value="insights">üí° Key Insights (Main Takeaways)</option>
        </select>
    </div>

    <div class="form-group">
        <label>Summary Length (for Bullet Points)</label>
        <select name="summary_length">
            <option value="short">üìù Short (3-5 points)</option>
            <option value="long">üìÑ Long (7-10 points)</option>
        </select>
    </div>

    <div class="form-group">
        <label>üåê Website URL</label>
        <input type="text" name="url" placeholder="https://example.com/article">
    </div>

    <div class="divider">OR</div>

    <div class="form-group">
        <label>üìÅ Upload a File</label>
        <div class="file-upload-section">
            <label class="file-upload-box" for="pdf-upload">
                <div class="file-upload-icon">üìÑ</div>
                <span class="file-upload-label">PDF</span>
                <span class="file-upload-hint">Click to upload</span>
                <input type="file" id="pdf-upload" name="pdf" accept=".pdf">
            </label>

            <label class="file-upload-box" for="docx-upload">
                <div class="file-upload-icon">üìù</div>
                <span class="file-upload-label">Word</span>
                <span class="file-upload-hint">.docx, .doc</span>
                <input type="file" id="docx-upload" name="docx" accept=".docx,.doc">
            </label>

            <label class="file-upload-box" for="pptx-upload">
                <div class="file-upload-icon">üìä</div>
                <span class="file-upload-label">PowerPoint</span>
                <span class="file-upload-hint">.pptx, .ppt</span>
                <input type="file" id="pptx-upload" name="pptx" accept=".pptx,.ppt">
            </label>

            <label class="file-upload-box" for="xlsx-upload">
                <div class="file-upload-icon">üìà</div>
                <span class="file-upload-label">Excel</span>
                <span class="file-upload-hint">.xlsx, .xls</span>
                <input type="file" id="xlsx-upload" name="xlsx" accept=".xlsx,.xls">
            </label>

            <label class="file-upload-box" for="image-upload">
                <div class="file-upload-icon">üñºÔ∏è</div>
                <span class="file-upload-label">Image (OCR)</span>
                <span class="file-upload-hint">.png, .jpg, .jpeg</span>
                <input type="file" id="image-upload" name="image" accept=".png,.jpg,.jpeg,.gif,.bmp,.tiff">
            </label>
        </div>
    </div>

    <button type="submit" class="btn-submit">Analyze Content</button>
</form>

{% if result %}
    {% if result.error %}
        <div class="card" style="border-left-color: #e74c3c;">
            <h3 style="color: #e74c3c;">‚ùå Error</h3>
            <p>{{ result.error }}</p>
        </div>
    {% else %}
        <div class="card">
            <h2>{{ result.title }}</h2>
            <p><em>{{ result.method }}</em></p>
            
            {% if result.metadata %}
            <div class="metadata-section">
                <strong>üìã Content Information:</strong>
                {% for key, value in result.metadata.items() %}
                <div class="metadata-item">
                    <span class="metadata-label">{{ key.replace('_', ' ').title() }}:</span>
                    <span class="metadata-value">{{ value }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Content Analysis Section -->
        {% if result.analysis %}
        <div class="analysis-grid">
            <div class="analysis-card">
                <h4>üòä Sentiment Analysis</h4>
                <div class="sentiment-box">
                    <div class="sentiment-emoji">{{ result.analysis.sentiment.emoji }}</div>
                    <div class="sentiment-label">{{ result.analysis.sentiment.sentiment }}</div>
                    <p style="margin: 10px 0 0 0; font-size: 13px; color: #666;">
                        {{ result.analysis.sentiment.description }}
                    </p>
                </div>
            </div>

            <div class="analysis-card">
                <h4>‚è±Ô∏è Reading Time</h4>
                <div class="reading-time">{{ result.analysis.reading_time.reading_time }}</div>
                <div class="stat-item">
                    <span class="stat-label">Word Count:</span>
                    <span class="stat-value">{{ result.analysis.reading_time.word_count }}</span>
                </div>
            </div>

            {% if result.analysis.language %}
            <div class="analysis-card">
                <h4>üåê Language</h4>
                <div class="language-info">
                    <div class="language-flag">üåç</div>
                    <div class="language-name">{{ result.analysis.language.language }}</div>
                    <p style="margin: 5px 0 0 0; font-size: 13px; color: #666;">
                        Confidence: {{ result.analysis.language.confidence }}
                    </p>
                </div>
            </div>
            {% endif %}

            {% if result.analysis.readability %}
            <div class="analysis-card">
                <h4>üìñ Readability</h4>
                <div class="readability-score">
                    <div class="readability-number">{{ result.analysis.readability.score }}</div>
                    <div class="readability-level">{{ result.analysis.readability.level }}</div>
                    <div class="readability-desc">{{ result.analysis.readability.description }}</div>
                </div>
            </div>
            {% endif %}

            <div class="analysis-card">
                <h4>üìä Content Stats</h4>
                <div class="stat-item">
                    <span class="stat-label">Sentences:</span>
                    <span class="stat-value">{{ result.analysis.statistics.total_sentences }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Unique Words:</span>
                    <span class="stat-value">{{ result.analysis.statistics.unique_words }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Avg Sentence Length:</span>
                    <span class="stat-value">{{ result.analysis.statistics.avg_sentence_length }} words</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Vocabulary Richness:</span>
                    <span class="stat-value">{{ result.analysis.statistics.vocabulary_richness }}%</span>
                </div>
            </div>
        </div>

        {% if result.analysis.topics %}
        <div class="card">
            <h3>üè∑Ô∏è Detected Topics</h3>
            <div class="topic-list">
                {% for topic in result.analysis.topics %}
                <div class="topic-item">
                    <span class="topic-name">{{ topic.topic }}</span>
                    <span class="topic-confidence">{{ topic.confidence }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if result.analysis.entities %}
        <div class="card">
            <h3>üîç Named Entities Detected</h3>
            <div class="entity-section">
                {% if result.analysis.entities.people %}
                <div class="entity-category">
                    <div class="entity-category-title">
                        <span class="entity-icon">üë§</span>
                        <span>People</span>
                    </div>
                    <div class="entity-list">
                        {% for person in result.analysis.entities.people %}
                        <span class="entity-badge person">{{ person }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if result.analysis.entities.organizations %}
                <div class="entity-category">
                    <div class="entity-category-title">
                        <span class="entity-icon">üè¢</span>
                        <span>Organizations</span>
                    </div>
                    <div class="entity-list">
                        {% for org in result.analysis.entities.organizations %}
                        <span class="entity-badge org">{{ org }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if result.analysis.entities.locations %}
                <div class="entity-category">
                    <div class="entity-category-title">
                        <span class="entity-icon">üåç</span>
                        <span>Locations</span>
                    </div>
                    <div class="entity-list">
                        {% for loc in result.analysis.entities.locations %}
                        <span class="entity-badge location">{{ loc }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if result.analysis.entities.dates %}
                <div class="entity-category">
                    <div class="entity-category-title">
                        <span class="entity-icon">üìÖ</span>
                        <span>Dates</span>
                    </div>
                    <div class="entity-list">
                        {% for date in result.analysis.entities.dates %}
                        <span class="entity-badge date">{{ date }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if result.analysis.entities.money %}
                <div class="entity-category">
                    <div class="entity-category-title">
                        <span class="entity-icon">üí∞</span>
                        <span>Money</span>
                    </div>
                    <div class="entity-list">
                        {% for money in result.analysis.entities.money %}
                        <span class="entity-badge money">{{ money }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if result.analysis.entities.other %}
                <div class="entity-category">
                    <div class="entity-category-title">
                        <span class="entity-icon">üîñ</span>
                        <span>Other</span>
                    </div>
                    <div class="entity-list">
                        {% for other in result.analysis.entities.other %}
                        <span class="entity-badge">{{ other }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="card">
            <h3>üîë Top Keywords</h3>
            <div class="keywords">
                {% for kw in result.analysis.keywords %}
                <span class="keyword-tag">{{ kw.word }} ({{ kw.frequency }})</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Summary Section -->
        {% if result.format == "qa" %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>‚ùì Q&A Summary</h3>
                <button class="copy-btn" onclick="copyToClipboard('{% for qa in result.qa_format %}Q: {{ qa.question }}\nA: {{ qa.answer }}\n\n{% endfor %}', this)">
                    üìã Copy All
                </button>
            </div>
            <div class="qa-container">
                {% for qa in result.qa_format %}
                <div class="qa-item">
                    <div class="qa-question">{{ qa.question }}</div>
                    <div class="qa-answer">{{ qa.answer }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        {% elif result.format == "timeline" %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>‚è±Ô∏è Timeline Summary</h3>
                <button class="copy-btn" onclick="copyToClipboard('{% for event in result.timeline %}{{ event.timestamp }}: {{ event.description }}\n{% endfor %}', this)">
                    üìã Copy All
                </button>
            </div>
            <div class="timeline-container">
                {% for event in result.timeline %}
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="timeline-timestamp">{{ event.timestamp }}</div>
                    <div class="timeline-description">{{ event.description }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        {% elif result.format == "insights" %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>üí° Key Insights</h3>
                <button class="copy-btn" onclick="copyToClipboard('{% for insight in result.insights %}üí° {{ insight }}\n{% endfor %}', this)">
                    üìã Copy All
                </button>
            </div>
            <div class="insights-container">
                {% for insight in result.insights %}
                <div class="insight-item">
                    <div class="insight-icon">üí°</div>
                    <div class="insight-text">{{ insight }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        {% else %}
        {% if result.executive_summary %}
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>üìå Executive Summary</h3>
                <button class="copy-btn" onclick="copyToClipboard('{{ result.executive_summary|join('. ')|replace("'", "\\'") }}', this)">
                    üìã Copy
                </button>
            </div>
            <ul>{% for i in result.executive_summary %}<li>{{ i }}</li>{% endfor %}</ul>
        </div>
        {% endif %}

        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>üìÑ Detailed Summary</h3>
                <button class="copy-btn" onclick="copyToClipboard('{{ result.detailed_summary|join('. ')|replace("'", "\\'") }}', this)">
                    üìã Copy
                </button>
            </div>
            <ul>{% for i in result.detailed_summary %}<li>{{ i }}</li>{% endfor %}</ul>
        </div>
        {% endif %}

        <div class="card">
            <div class="confidence">
                üéØ Summary Confidence Score: {{ result.confidence_score }}
            </div>
        </div>

        <!-- Export Section -->
        {% if not from_history %}
        <div class="card">
            <h3>üì• Export Results</h3>
            <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                Download this analysis in your preferred format
            </p>
            <div class="export-grid">
                <a href="{{ url_for('export_current_analysis', format='pdf') }}" class="export-btn export-pdf">
                    üìÑ Export PDF
                </a>
                
                <a href="{{ url_for('export_current_analysis', format='docx') }}" class="export-btn export-docx">
                    üìù Export Word
                </a>
                
                <a href="{{ url_for('export_current_analysis', format='markdown') }}" class="export-btn export-md">
                    üìã Export MD
                </a>
                
                <a href="{{ url_for('export_current_analysis', format='json') }}" class="export-btn export-json">
                    { } Export JSON
                </a>
            </div>
        </div>
        {% endif %}

        <!-- CHAT INTERFACE -->
        {% if result.doc_id %}
        <div class="chat-section">
            <div class="chat-header">
                <div class="chat-header-icon">üí¨</div>
                <div class="chat-header-text">
                    <h3>Chat with Document</h3>
                    <p>Ask questions about the content - powered by AI</p>
                </div>
            </div>

            {% if result.suggested_questions %}
            <div class="suggested-questions">
                <h4>üí° Suggested Questions:</h4>
                <div class="question-chips">
                    {% for question in result.suggested_questions %}
                    <div class="question-chip" onclick="askQuestion('{{ question|replace("'", "\\'") }}')">{{ question }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div class="chat-messages" id="chatMessages">
                <div class="empty-chat">
                    <div class="empty-chat-icon">üí≠</div>
                    <div class="empty-chat-text">Ask me anything about this document!</div>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <input 
                        type="text" 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Ask a question about the document..."
                    >
                    <button class="chat-send-btn" id="sendBtn" onclick="sendMessage()">
                        ‚û§
                    </button>
                </div>
            </div>
        </div>

        <script>
        const DOC_ID = '{{ result.doc_id }}';
        let conversationHistory = [];

        function addMessage(role, content, sources = null) {
            const messagesDiv = document.getElementById('chatMessages');
            
            const emptyChat = messagesDiv.querySelector('.empty-chat');
            if (emptyChat) {
                emptyChat.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = `message-avatar ${role}-avatar`;
            avatarDiv.textContent = role === 'user' ? 'üë§' : 'ü§ñ';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = content;

            if (sources && sources.length > 0) {
                const sourcesDiv = document.createElement('div');
                sourcesDiv.className = 'message-sources';
                sourcesDiv.innerHTML = '<div class="message-sources-title">üìö Sources:</div>';
                
                sources.forEach((source, idx) => {
                    const sourceItem = document.createElement('div');
                    sourceItem.className = 'source-item';
                    sourceItem.textContent = `Chunk ${source.chunk_index + 1}: ${source.text}`;
                    sourcesDiv.appendChild(sourceItem);
                });
                
                contentDiv.appendChild(sourcesDiv);
            }
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesDiv = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message assistant';
            typingDiv.id = 'typingIndicator';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'message-avatar bot-avatar';
            avatarDiv.textContent = 'ü§ñ';
            
            const typingContent = document.createElement('div');
            typingContent.className = 'typing-indicator';
            typingContent.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            
            typingDiv.appendChild(avatarDiv);
            typingDiv.appendChild(typingContent);
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const question = input.value.trim();
            
            if (!question) return;
            
            input.disabled = true;
            sendBtn.disabled = true;
            
            addMessage('user', question);
            conversationHistory.push({ role: 'user', content: question });
            
            input.value = '';
            
            showTypingIndicator();
            
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: question,
                        doc_id: DOC_ID,
                        history: conversationHistory
                    })
                });
                
                const data = await response.json();
                
                removeTypingIndicator();
                
                if (data.error) {
                    addMessage('assistant', `Error: ${data.error}`);
                } else {
                    addMessage('assistant', data.answer, data.sources);
                    conversationHistory.push({ role: 'assistant', content: data.answer });
                }
            } catch (error) {
                removeTypingIndicator();
                addMessage('assistant', `Error: ${error.message}`);
            } finally {
                input.disabled = false;
                sendBtn.disabled = false;
                input.focus();
            }
        }

        function askQuestion(question) {
            const input = document.getElementById('chatInput');
            input.value = question;
            sendMessage();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        event.preventDefault();
                        sendMessage();
                    }
                });
            }
        });
        </script>
        {% endif %}
    {% endif %}
{% endif %}
</div>

<!-- Dark Mode Toggle Button -->
<button class="dark-mode-toggle" id="darkModeBtn" onclick="toggleDarkMode()" title="Toggle Dark Mode (Ctrl+D)">
    <span id="darkModeIcon">üåô</span>
</button>

<!-- Keyboard Shortcuts Help -->
<div class="keyboard-shortcuts" id="shortcutsHelp">
    <div style="font-weight: 600; margin-bottom: 10px; color: #667eea;">‚å®Ô∏è Keyboard Shortcuts</div>
    <div class="shortcut-item">
        <span>New Analysis</span>
        <span class="shortcut-key">Ctrl+N</span>
    </div>
    <div class="shortcut-item">
        <span>History</span>
        <span class="shortcut-key">Ctrl+H</span>
    </div>
    <div class="shortcut-item">
        <span>Dark Mode</span>
        <span class="shortcut-key">Ctrl+D</span>
    </div>
    <div class="shortcut-item">
        <span>Search</span>
        <span class="shortcut-key">Ctrl+K</span>
    </div>
</div>

<script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>